# Dispatch Operations Data Models - Lucky Gas Legacy System

## Entity Definitions

### 1. Route (路線主檔)
Route:
  table_name: "ROUTE_MASTER"
  chinese_name: "路線主檔"
  description: "Defines delivery routes with geographic boundaries and characteristics"
  
  fields:
    - name: "ROUTE_ID"
      type: "varchar(20)"
      primary_key: true
      description: "Unique route identifier"
      example: "RT-TPE-001"
      
    - name: "ROUTE_NAME"
      type: "varchar(100)"
      required: true
      description: "Route name/description"
      chinese: "路線名稱"
      
    - name: "ZONE_CODE"
      type: "varchar(10)"
      required: true
      description: "Geographic zone code"
      foreign_key: "ZONE_MASTER.ZONE_CODE"
      
    - name: "ROUTE_TYPE"
      type: "varchar(20)"
      required: true
      description: "Route classification"
      values: ["REGULAR", "EXPRESS", "SUBURBAN", "INDUSTRIAL"]
      
    - name: "BASE_DISTANCE"
      type: "decimal(10,2)"
      description: "Standard route distance in km"
      
    - name: "BASE_DURATION"
      type: "int"
      description: "Standard route duration in minutes"
      
    - name: "MAX_STOPS"
      type: "int"
      default: 25
      description: "Maximum delivery stops"
      
    - name: "VEHICLE_TYPE"
      type: "varchar(20)"
      required: true
      description: "Required vehicle type"
      foreign_key: "VEHICLE_TYPE.TYPE_CODE"
      
    - name: "SKILL_REQUIRED"
      type: "varchar(50)"
      description: "Special skills needed"
      
    - name: "ACTIVE_FLAG"
      type: "char(1)"
      default: "Y"
      values: ["Y", "N"]

### 2. DispatchHeader (派遣單頭檔)
DispatchHeader:
  table_name: "DISPATCH_HEADER"
  chinese_name: "派遣單頭檔"
  description: "Daily dispatch assignments for routes"
  
  fields:
    - name: "DISPATCH_ID"
      type: "varchar(20)"
      primary_key: true
      description: "Unique dispatch identifier"
      example: "DSP-20240120-001"
      
    - name: "DISPATCH_DATE"
      type: "date"
      required: true
      description: "Dispatch date"
      
    - name: "ROUTE_ID"
      type: "varchar(20)"
      required: true
      foreign_key: "ROUTE_MASTER.ROUTE_ID"
      
    - name: "DRIVER_ID"
      type: "varchar(20)"
      required: true
      foreign_key: "DRIVER_MASTER.DRIVER_ID"
      
    - name: "VEHICLE_ID"
      type: "varchar(20)"
      required: true
      foreign_key: "VEHICLE_MASTER.VEHICLE_ID"
      
    - name: "HELPER_ID"
      type: "varchar(20)"
      description: "Assistant/helper assignment"
      foreign_key: "DRIVER_MASTER.DRIVER_ID"
      
    - name: "PLANNED_START"
      type: "datetime"
      required: true
      description: "Planned departure time"
      
    - name: "ACTUAL_START"
      type: "datetime"
      description: "Actual departure time"
      
    - name: "PLANNED_END"
      type: "datetime"
      description: "Planned return time"
      
    - name: "ACTUAL_END"
      type: "datetime"
      description: "Actual return time"
      
    - name: "TOTAL_STOPS"
      type: "int"
      description: "Number of delivery stops"
      
    - name: "COMPLETED_STOPS"
      type: "int"
      default: 0
      description: "Stops completed"
      
    - name: "STATUS"
      type: "varchar(20)"
      required: true
      values: ["PLANNED", "LOADING", "IN_TRANSIT", "RETURNING", "COMPLETED", "CANCELLED"]
      
    - name: "TOTAL_WEIGHT"
      type: "decimal(10,2)"
      description: "Total load weight in kg"
      
    - name: "TOTAL_CYLINDERS"
      type: "int"
      description: "Total cylinders loaded"

### 3. DispatchDetail (派遣單明細)
DispatchDetail:
  table_name: "DISPATCH_DETAIL"
  chinese_name: "派遣單明細"
  description: "Individual delivery stops within a dispatch"
  
  fields:
    - name: "DETAIL_ID"
      type: "bigint"
      primary_key: true
      auto_increment: true
      
    - name: "DISPATCH_ID"
      type: "varchar(20)"
      required: true
      foreign_key: "DISPATCH_HEADER.DISPATCH_ID"
      
    - name: "STOP_SEQUENCE"
      type: "int"
      required: true
      description: "Delivery sequence number"
      
    - name: "ORDER_ID"
      type: "varchar(20)"
      required: true
      foreign_key: "ORDER_HEADER.ORDER_ID"
      
    - name: "CUSTOMER_ID"
      type: "varchar(20)"
      required: true
      foreign_key: "CUSTOMER_MASTER.CUSTOMER_ID"
      
    - name: "DELIVERY_ADDRESS"
      type: "varchar(500)"
      required: true
      description: "Full delivery address"
      
    - name: "CONTACT_PHONE"
      type: "varchar(50)"
      description: "Contact phone number"
      
    - name: "TIME_WINDOW_START"
      type: "time"
      description: "Earliest delivery time"
      
    - name: "TIME_WINDOW_END"
      type: "time"
      description: "Latest delivery time"
      
    - name: "ESTIMATED_ARRIVAL"
      type: "datetime"
      description: "System calculated ETA"
      
    - name: "ACTUAL_ARRIVAL"
      type: "datetime"
      description: "Actual arrival time"
      
    - name: "DELIVERY_STATUS"
      type: "varchar(20)"
      values: ["PENDING", "EN_ROUTE", "ARRIVED", "DELIVERED", "FAILED", "RESCHEDULED"]
      
    - name: "DELIVERY_NOTES"
      type: "text"
      description: "Special delivery instructions"
      
    - name: "SIGNATURE_IMAGE"
      type: "varchar(255)"
      description: "Path to signature file"
      
    - name: "PHOTO_PROOF"
      type: "varchar(255)"
      description: "Path to delivery photo"

### 4. LoadingSheet (載貨單)
LoadingSheet:
  table_name: "LOADING_SHEET"
  chinese_name: "載貨單"
  description: "Details of products loaded for dispatch"
  
  fields:
    - name: "LOAD_ID"
      type: "varchar(20)"
      primary_key: true
      description: "Loading sheet number"
      example: "LD-20240120-001"
      
    - name: "DISPATCH_ID"
      type: "varchar(20)"
      required: true
      foreign_key: "DISPATCH_HEADER.DISPATCH_ID"
      
    - name: "LOAD_DATE"
      type: "datetime"
      required: true
      description: "Loading date and time"
      
    - name: "WAREHOUSE_ID"
      type: "varchar(10)"
      required: true
      description: "Loading warehouse"
      
    - name: "LOADER_ID"
      type: "varchar(20)"
      required: true
      description: "Warehouse staff ID"
      
    - name: "PRODUCT_CODE"
      type: "varchar(20)"
      required: true
      foreign_key: "PRODUCT_MASTER.PRODUCT_CODE"
      
    - name: "CYLINDER_TYPE"
      type: "varchar(20)"
      required: true
      description: "Cylinder size/type"
      
    - name: "QUANTITY_LOADED"
      type: "int"
      required: true
      description: "Number of cylinders"
      
    - name: "QUANTITY_EMPTY"
      type: "int"
      default: 0
      description: "Empty cylinders loaded"
      
    - name: "SEAL_NUMBER"
      type: "varchar(50)"
      description: "Security seal number"
      
    - name: "CHECKED_BY"
      type: "varchar(20)"
      description: "Quality checker ID"
      
    - name: "DRIVER_CONFIRM"
      type: "char(1)"
      values: ["Y", "N"]
      description: "Driver confirmation"

### 5. Vehicle (車輛主檔)
Vehicle:
  table_name: "VEHICLE_MASTER"
  chinese_name: "車輛主檔"
  description: "Fleet vehicle information"
  
  fields:
    - name: "VEHICLE_ID"
      type: "varchar(20)"
      primary_key: true
      description: "Unique vehicle identifier"
      
    - name: "PLATE_NUMBER"
      type: "varchar(20)"
      required: true
      unique: true
      description: "License plate number"
      
    - name: "VEHICLE_TYPE"
      type: "varchar(20)"
      required: true
      description: "Vehicle classification"
      values: ["TRUCK_3.5T", "TRUCK_5T", "TRUCK_8T", "VAN", "MOTORCYCLE"]
      
    - name: "BRAND"
      type: "varchar(50)"
      description: "Vehicle manufacturer"
      
    - name: "MODEL"
      type: "varchar(50)"
      description: "Vehicle model"
      
    - name: "YEAR"
      type: "int"
      description: "Manufacturing year"
      
    - name: "CAPACITY_KG"
      type: "decimal(10,2)"
      description: "Load capacity in kg"
      
    - name: "FUEL_TYPE"
      type: "varchar(20)"
      values: ["DIESEL", "GASOLINE", "LPG", "ELECTRIC"]
      
    - name: "LAST_INSPECTION"
      type: "date"
      description: "Last inspection date"
      
    - name: "NEXT_INSPECTION"
      type: "date"
      description: "Next inspection due"
      
    - name: "INSURANCE_EXPIRY"
      type: "date"
      description: "Insurance expiration"
      
    - name: "GPS_DEVICE_ID"
      type: "varchar(50)"
      description: "GPS tracker ID"
      
    - name: "STATUS"
      type: "varchar(20)"
      values: ["ACTIVE", "MAINTENANCE", "REPAIR", "RETIRED"]
      
    - name: "HOME_DEPOT"
      type: "varchar(10)"
      description: "Base location"

### 6. Driver (司機主檔)
Driver:
  table_name: "DRIVER_MASTER"
  chinese_name: "司機主檔"
  description: "Driver and delivery personnel information"
  
  fields:
    - name: "DRIVER_ID"
      type: "varchar(20)"
      primary_key: true
      description: "Employee/Driver ID"
      
    - name: "DRIVER_NAME"
      type: "nvarchar(100)"
      required: true
      description: "Driver full name"
      
    - name: "ID_NUMBER"
      type: "varchar(20)"
      required: true
      unique: true
      description: "National ID number"
      
    - name: "LICENSE_NUMBER"
      type: "varchar(50)"
      required: true
      description: "Driving license number"
      
    - name: "LICENSE_TYPE"
      type: "varchar(20)"
      required: true
      description: "License category"
      values: ["PROFESSIONAL", "REGULAR", "HEAVY", "MOTORCYCLE"]
      
    - name: "LICENSE_EXPIRY"
      type: "date"
      required: true
      description: "License expiration date"
      
    - name: "PHONE_NUMBER"
      type: "varchar(20)"
      required: true
      description: "Contact number"
      
    - name: "EMERGENCY_CONTACT"
      type: "varchar(100)"
      description: "Emergency contact info"
      
    - name: "HIRE_DATE"
      type: "date"
      required: true
      description: "Employment start date"
      
    - name: "EXPERIENCE_YEARS"
      type: "int"
      description: "Driving experience"
      
    - name: "SAFETY_SCORE"
      type: "decimal(3,2)"
      description: "Safety rating (0-5)"
      
    - name: "PERFORMANCE_SCORE"
      type: "decimal(3,2)"
      description: "Performance rating (0-5)"
      
    - name: "PREFERRED_ROUTES"
      type: "varchar(200)"
      description: "Preferred route codes"
      
    - name: "RESTRICTIONS"
      type: "varchar(500)"
      description: "Any restrictions/limitations"
      
    - name: "STATUS"
      type: "varchar(20)"
      values: ["ACTIVE", "ON_LEAVE", "SUSPENDED", "TERMINATED"]

### 7. DeliveryTracking (配送追蹤)
DeliveryTracking:
  table_name: "DELIVERY_TRACKING"
  chinese_name: "配送追蹤"
  description: "Real-time delivery status updates"
  
  fields:
    - name: "TRACKING_ID"
      type: "bigint"
      primary_key: true
      auto_increment: true
      
    - name: "DISPATCH_ID"
      type: "varchar(20)"
      required: true
      foreign_key: "DISPATCH_HEADER.DISPATCH_ID"
      
    - name: "TIMESTAMP"
      type: "datetime"
      required: true
      description: "Event timestamp"
      
    - name: "LATITUDE"
      type: "decimal(10,7)"
      description: "GPS latitude"
      
    - name: "LONGITUDE"
      type: "decimal(10,7)"
      description: "GPS longitude"
      
    - name: "SPEED_KMH"
      type: "decimal(5,2)"
      description: "Vehicle speed"
      
    - name: "EVENT_TYPE"
      type: "varchar(50)"
      required: true
      values: ["START", "STOP_ARRIVAL", "STOP_DEPARTURE", "BREAK", "REFUEL", "RETURN", "EMERGENCY"]
      
    - name: "STOP_SEQUENCE"
      type: "int"
      description: "Current stop number"
      
    - name: "REMAINING_STOPS"
      type: "int"
      description: "Stops remaining"
      
    - name: "DELAY_MINUTES"
      type: "int"
      description: "Schedule deviation"
      
    - name: "NOTES"
      type: "varchar(500)"
      description: "Event notes"

### 8. RouteOptimization (路線優化)
RouteOptimization:
  table_name: "ROUTE_OPTIMIZATION"
  chinese_name: "路線優化紀錄"
  description: "Route optimization history and results"
  
  fields:
    - name: "OPTIMIZATION_ID"
      type: "varchar(20)"
      primary_key: true
      description: "Optimization run ID"
      
    - name: "RUN_DATE"
      type: "datetime"
      required: true
      description: "Optimization run time"
      
    - name: "ROUTE_DATE"
      type: "date"
      required: true
      description: "Target delivery date"
      
    - name: "ALGORITHM"
      type: "varchar(50)"
      description: "Algorithm used"
      values: ["GENETIC", "SIMULATED_ANNEALING", "NEAREST_NEIGHBOR", "CLARKE_WRIGHT"]
      
    - name: "TOTAL_ORDERS"
      type: "int"
      description: "Orders to optimize"
      
    - name: "TOTAL_ROUTES"
      type: "int"
      description: "Routes generated"
      
    - name: "ORIGINAL_DISTANCE"
      type: "decimal(10,2)"
      description: "Distance before optimization"
      
    - name: "OPTIMIZED_DISTANCE"
      type: "decimal(10,2)"
      description: "Distance after optimization"
      
    - name: "DISTANCE_SAVED"
      type: "decimal(5,2)"
      description: "Percentage saved"
      
    - name: "ORIGINAL_TIME"
      type: "int"
      description: "Time before (minutes)"
      
    - name: "OPTIMIZED_TIME"
      type: "int"
      description: "Time after (minutes)"
      
    - name: "TIME_SAVED"
      type: "decimal(5,2)"
      description: "Percentage saved"
      
    - name: "CONSTRAINTS_USED"
      type: "text"
      description: "Optimization constraints"
      
    - name: "ACCEPTED_FLAG"
      type: "char(1)"
      values: ["Y", "N"]
      description: "Results accepted"

### 9. PerformanceMetrics (績效指標)
PerformanceMetrics:
  table_name: "DISPATCH_PERFORMANCE"
  chinese_name: "調度績效指標"
  description: "Daily performance metrics for dispatch operations"
  
  fields:
    - name: "METRIC_ID"
      type: "bigint"
      primary_key: true
      auto_increment: true
      
    - name: "METRIC_DATE"
      type: "date"
      required: true
      description: "Metric date"
      
    - name: "METRIC_TYPE"
      type: "varchar(50)"
      required: true
      values: ["DRIVER", "ROUTE", "VEHICLE", "OVERALL"]
      
    - name: "ENTITY_ID"
      type: "varchar(20)"
      description: "Driver/Route/Vehicle ID"
      
    - name: "DELIVERIES_PLANNED"
      type: "int"
      description: "Planned deliveries"
      
    - name: "DELIVERIES_COMPLETED"
      type: "int"
      description: "Successful deliveries"
      
    - name: "ON_TIME_COUNT"
      type: "int"
      description: "On-time deliveries"
      
    - name: "ON_TIME_RATE"
      type: "decimal(5,2)"
      description: "On-time percentage"
      
    - name: "DISTANCE_KM"
      type: "decimal(10,2)"
      description: "Total distance"
      
    - name: "FUEL_LITERS"
      type: "decimal(10,2)"
      description: "Fuel consumed"
      
    - name: "FUEL_EFFICIENCY"
      type: "decimal(5,2)"
      description: "KM per liter"
      
    - name: "DELIVERY_TIME_AVG"
      type: "int"
      description: "Average minutes per delivery"
      
    - name: "CUSTOMER_RATING"
      type: "decimal(3,2)"
      description: "Average rating (1-5)"
      
    - name: "INCIDENTS_COUNT"
      type: "int"
      default: 0
      description: "Safety incidents"

## Indexes

dispatch_indexes:
  - table: "DISPATCH_HEADER"
    indexes:
      - name: "IDX_DISPATCH_DATE"
        columns: ["DISPATCH_DATE", "STATUS"]
      - name: "IDX_DRIVER_DATE"
        columns: ["DRIVER_ID", "DISPATCH_DATE"]
      - name: "IDX_VEHICLE_DATE"
        columns: ["VEHICLE_ID", "DISPATCH_DATE"]
        
  - table: "DISPATCH_DETAIL"
    indexes:
      - name: "IDX_CUSTOMER_DELIVERY"
        columns: ["CUSTOMER_ID", "DELIVERY_STATUS"]
      - name: "IDX_ORDER_DISPATCH"
        columns: ["ORDER_ID"]
      - name: "IDX_DELIVERY_TIME"
        columns: ["ESTIMATED_ARRIVAL", "ACTUAL_ARRIVAL"]
        
  - table: "DELIVERY_TRACKING"
    indexes:
      - name: "IDX_TRACKING_TIME"
        columns: ["DISPATCH_ID", "TIMESTAMP"]
      - name: "IDX_LOCATION"
        columns: ["LATITUDE", "LONGITUDE", "TIMESTAMP"]

## Relationships

entity_relationships:
  - parent: "ROUTE_MASTER"
    child: "DISPATCH_HEADER"
    type: "one-to-many"
    foreign_key: "ROUTE_ID"
    
  - parent: "DISPATCH_HEADER"
    child: "DISPATCH_DETAIL"
    type: "one-to-many"
    foreign_key: "DISPATCH_ID"
    
  - parent: "DISPATCH_HEADER"
    child: "LOADING_SHEET"
    type: "one-to-many"
    foreign_key: "DISPATCH_ID"
    
  - parent: "VEHICLE_MASTER"
    child: "DISPATCH_HEADER"
    type: "one-to-many"
    foreign_key: "VEHICLE_ID"
    
  - parent: "DRIVER_MASTER"
    child: "DISPATCH_HEADER"
    type: "one-to-many"
    foreign_key: "DRIVER_ID"
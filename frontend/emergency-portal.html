<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üö® Emergency Access Portal - LuckyGas</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            padding: 20px;
            min-height: 100vh;
        }
        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
        }
        h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }
        .subtitle {
            font-size: 16px;
            opacity: 0.9;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .card {
            background: #2a2a2a;
            border: 2px solid #444;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s;
        }
        .card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }
        .card-title {
            color: #fff;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .card-description {
            color: #aaa;
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.5;
        }
        button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .success-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
        }
        .warning-btn {
            background: linear-gradient(135deg, #ffc107, #ff9800);
        }
        .danger-btn {
            background: linear-gradient(135deg, #dc3545, #c82333);
        }
        .input-group {
            margin-bottom: 15px;
        }
        .input-group label {
            display: block;
            color: #aaa;
            font-size: 14px;
            margin-bottom: 5px;
        }
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 10px;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 6px;
            color: white;
            font-size: 14px;
        }
        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        .status-box {
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 14px;
        }
        .status-success {
            background: #155724;
            color: #d4edda;
            border: 1px solid #28a745;
        }
        .status-error {
            background: #721c24;
            color: #f8d7da;
            border: 1px solid #dc3545;
        }
        .status-info {
            background: #004085;
            color: #d1ecf1;
            border: 1px solid #17a2b8;
        }
        .code-block {
            background: #000;
            border: 1px solid #444;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #0f0;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }
        .diagnostic-output {
            background: #000;
            border: 2px solid #0f0;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #0f0;
            max-height: 400px;
            overflow-y: auto;
        }
        .blink {
            animation: blink 1s infinite;
        }
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        .quick-links {
            background: #2a2a2a;
            border: 2px solid #667eea;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
        }
        .quick-links h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        .link-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        .link-btn {
            padding: 10px;
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 6px;
            color: #aaa;
            text-decoration: none;
            text-align: center;
            transition: all 0.3s;
        }
        .link-btn:hover {
            background: #333;
            border-color: #667eea;
            color: white;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üö® Emergency Access Portal</h1>
        <p class="subtitle">Multiple methods to bypass login issues and access the system</p>
    </div>

    <!-- Quick Links -->
    <div class="quick-links">
        <h3>üîó Quick Access Links</h3>
        <div class="link-grid">
            <a href="https://storage.googleapis.com/luckygas-frontend-prod/index.html" class="link-btn" target="_blank">Main Frontend</a>
            <a href="https://storage.googleapis.com/luckygas-frontend-prod/bypass-login.html" class="link-btn" target="_blank">Bypass Login v1</a>
            <a href="https://storage.googleapis.com/luckygas-frontend-prod/bypass-login-enhanced.html" class="link-btn" target="_blank">Enhanced Login</a>
            <a href="https://luckygas-backend-step4-yzoirwjj3q-de.a.run.app/api/v1/docs" class="link-btn" target="_blank">API Docs</a>
        </div>
    </div>

    <!-- Method Cards -->
    <div class="grid">
        <!-- Method 1: Quick Token Injection -->
        <div class="card">
            <div class="card-title">
                <span>‚ö°</span> Method 1: Quick Token Injection
            </div>
            <div class="card-description">
                Instantly get a fresh token and inject it into the browser. This bypasses all login forms.
            </div>
            <button onclick="quickTokenInjection()" class="success-btn">
                Get Token & Access Dashboard
            </button>
            <div id="method1-status"></div>
        </div>

        <!-- Method 2: Form-Encoded Login -->
        <div class="card">
            <div class="card-title">
                <span>üìù</span> Method 2: Form-Encoded Login
            </div>
            <div class="card-description">
                Traditional form login (working method confirmed by tests).
            </div>
            <div class="input-group">
                <label>Email</label>
                <input type="email" id="form-email" value="admin@luckygas.com">
            </div>
            <div class="input-group">
                <label>Password</label>
                <input type="password" id="form-password" value="admin-password-2025">
            </div>
            <button onclick="formLogin()">Login with Form Data</button>
            <div id="method2-status"></div>
        </div>

        <!-- Method 3: JSON Login -->
        <div class="card">
            <div class="card-title">
                <span>üîß</span> Method 3: JSON Login
            </div>
            <div class="card-description">
                Alternative JSON-based login method.
            </div>
            <button onclick="jsonLogin()">Try JSON Login</button>
            <div id="method3-status"></div>
        </div>

        <!-- Method 4: GET Request Login -->
        <div class="card">
            <div class="card-title">
                <span>üåê</span> Method 4: GET Request Login
            </div>
            <div class="card-description">
                Simple GET request with credentials in URL (emergency method).
            </div>
            <button onclick="getLogin()" class="warning-btn">Emergency GET Login</button>
            <div id="method4-status"></div>
        </div>

        <!-- Method 5: Manual Token Entry -->
        <div class="card">
            <div class="card-title">
                <span>üîë</span> Method 5: Manual Token Entry
            </div>
            <div class="card-description">
                Have a token already? Paste it here to access the dashboard.
            </div>
            <div class="input-group">
                <label>JWT Token</label>
                <textarea id="manual-token" rows="3" placeholder="Paste your JWT token here..."></textarea>
            </div>
            <button onclick="manualTokenAccess()">Use This Token</button>
            <div id="method5-status"></div>
        </div>

        <!-- Method 6: Console Script -->
        <div class="card">
            <div class="card-title">
                <span>üíª</span> Method 6: Console Script
            </div>
            <div class="card-description">
                Copy this script and run it in your browser console (F12).
            </div>
            <button onclick="generateConsoleScript()">Generate Console Script</button>
            <div id="method6-status"></div>
            <div id="console-script" class="code-block" style="display: none;"></div>
        </div>

        <!-- Method 7: Bookmarklet -->
        <div class="card">
            <div class="card-title">
                <span>üîñ</span> Method 7: Bookmarklet
            </div>
            <div class="card-description">
                Create a bookmark that logs you in with one click.
            </div>
            <button onclick="createBookmarklet()">Generate Bookmarklet</button>
            <div id="method7-status"></div>
        </div>

        <!-- Method 8: Force Dashboard -->
        <div class="card">
            <div class="card-title">
                <span>üö™</span> Method 8: Force Dashboard Access
            </div>
            <div class="card-description">
                Skip everything and go directly to dashboard (may not work if auth is checked).
            </div>
            <button onclick="forceDashboard()" class="danger-btn">Force Access (No Auth)</button>
            <div id="method8-status"></div>
        </div>
    </div>

    <!-- Diagnostic Output -->
    <div class="diagnostic-output">
        <div style="color: #0f0; font-weight: bold; margin-bottom: 10px;">
            SYSTEM DIAGNOSTIC OUTPUT <span class="blink">_</span>
        </div>
        <div id="diagnostics">
            [INITIALIZING EMERGENCY ACCESS PORTAL...]
            [BACKEND URL: https://luckygas-backend-step4-yzoirwjj3q-de.a.run.app]
            [FRONTEND URL: https://storage.googleapis.com/luckygas-frontend-prod]
            [READY FOR EMERGENCY ACCESS ATTEMPTS]
        </div>
    </div>

    <script>
        const BACKEND_URL = 'https://luckygas-backend-step4-yzoirwjj3q-de.a.run.app';
        const FRONTEND_URL = 'https://storage.googleapis.com/luckygas-frontend-prod';
        let latestToken = null;

        function log(message) {
            const diagnostics = document.getElementById('diagnostics');
            const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
            diagnostics.innerHTML += `\n[${timestamp}] ${message}`;
            diagnostics.scrollTop = diagnostics.scrollHeight;
            console.log(`[EMERGENCY] ${message}`);
        }

        function showStatus(methodId, message, type = 'info') {
            const statusEl = document.getElementById(`${methodId}-status`);
            statusEl.className = `status-box status-${type}`;
            statusEl.textContent = message;
            statusEl.style.display = 'block';
        }

        async function quickTokenInjection() {
            log('METHOD 1: Starting quick token injection...');
            
            try {
                // Get fresh token
                const formData = new URLSearchParams({
                    username: 'admin@luckygas.com',
                    password: 'admin-password-2025'
                });

                log('Requesting fresh token from backend...');
                
                const response = await fetch(`${BACKEND_URL}/api/v1/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: formData
                });

                const data = await response.json();
                
                if (response.ok && data.access_token) {
                    latestToken = data.access_token;
                    log(`SUCCESS: Token received: ${latestToken.substring(0, 50)}...`);
                    
                    // Inject into localStorage
                    const tokenKeys = ['token', 'auth_token', 'jwt', 'access_token', 'authToken'];
                    tokenKeys.forEach(key => {
                        localStorage.setItem(key, latestToken);
                        log(`Injected token into localStorage.${key}`);
                    });
                    
                    localStorage.setItem('user', JSON.stringify({
                        email: 'admin@luckygas.com',
                        role: 'admin'
                    }));
                    
                    showStatus('method1', '‚úÖ Token injected! Redirecting in 3 seconds...', 'success');
                    
                    setTimeout(() => {
                        window.location.href = `${FRONTEND_URL}/index.html#/dashboard`;
                    }, 3000);
                    
                } else {
                    throw new Error(data.detail || 'Failed to get token');
                }
                
            } catch (error) {
                log(`ERROR: ${error.message}`);
                showStatus('method1', `‚ùå Error: ${error.message}`, 'error');
            }
        }

        async function formLogin() {
            log('METHOD 2: Form-encoded login attempt...');
            
            const email = document.getElementById('form-email').value;
            const password = document.getElementById('form-password').value;
            
            try {
                const formData = new URLSearchParams({
                    username: email,
                    password: password
                });

                log(`Attempting login with ${email}`);
                
                const response = await fetch(`${BACKEND_URL}/api/v1/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: formData
                });

                const data = await response.json();
                
                if (response.ok && data.access_token) {
                    latestToken = data.access_token;
                    log(`SUCCESS: Login successful, token: ${latestToken.substring(0, 50)}...`);
                    
                    localStorage.setItem('token', latestToken);
                    localStorage.setItem('auth_token', latestToken);
                    
                    showStatus('method2', '‚úÖ Login successful! Token stored. Redirecting...', 'success');
                    
                    setTimeout(() => {
                        window.location.href = `${FRONTEND_URL}/index.html#/dashboard`;
                    }, 2000);
                    
                } else {
                    throw new Error(data.detail || 'Login failed');
                }
                
            } catch (error) {
                log(`ERROR: ${error.message}`);
                showStatus('method2', `‚ùå ${error.message}`, 'error');
            }
        }

        async function jsonLogin() {
            log('METHOD 3: JSON login attempt...');
            
            try {
                const response = await fetch(`${BACKEND_URL}/api/v1/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        username: 'admin@luckygas.com',
                        password: 'admin-password-2025'
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.access_token) {
                    latestToken = data.access_token;
                    log(`SUCCESS: JSON login worked! Token: ${latestToken.substring(0, 50)}...`);
                    showStatus('method3', '‚úÖ JSON login successful!', 'success');
                } else {
                    log(`JSON login returned: ${JSON.stringify(data)}`);
                    showStatus('method3', `‚ùå JSON login not supported: ${data.detail || response.status}`, 'error');
                }
                
            } catch (error) {
                log(`ERROR: ${error.message}`);
                showStatus('method3', `‚ùå ${error.message}`, 'error');
            }
        }

        async function getLogin() {
            log('METHOD 4: GET request login (emergency)...');
            
            const url = `${BACKEND_URL}/api/v1/auth/login?username=admin@luckygas.com&password=admin-password-2025`;
            
            try {
                const response = await fetch(url);
                const data = await response.json();
                
                if (response.ok && data.access_token) {
                    log(`SUCCESS: GET login worked!`);
                    showStatus('method4', '‚úÖ GET login successful!', 'success');
                } else {
                    log(`GET login not supported: ${response.status}`);
                    showStatus('method4', '‚ùå GET login not supported (expected)', 'error');
                }
                
            } catch (error) {
                log(`ERROR: ${error.message}`);
                showStatus('method4', `‚ùå ${error.message}`, 'error');
            }
        }

        function manualTokenAccess() {
            log('METHOD 5: Manual token injection...');
            
            const token = document.getElementById('manual-token').value.trim();
            
            if (!token) {
                showStatus('method5', '‚ùå Please paste a token', 'error');
                return;
            }
            
            localStorage.setItem('token', token);
            localStorage.setItem('auth_token', token);
            localStorage.setItem('jwt', token);
            
            log(`Injected manual token: ${token.substring(0, 50)}...`);
            showStatus('method5', '‚úÖ Token injected! Redirecting...', 'success');
            
            setTimeout(() => {
                window.location.href = `${FRONTEND_URL}/index.html#/dashboard`;
            }, 2000);
        }

        async function generateConsoleScript() {
            log('METHOD 6: Generating console script...');
            
            // Get fresh token first
            if (!latestToken) {
                await quickTokenInjection();
            }
            
            const script = `
// LuckyGas Emergency Access Script
// Run this in your browser console (F12)

const token = '${latestToken || 'PASTE_TOKEN_HERE'}';
const tokenKeys = ['token', 'auth_token', 'jwt', 'access_token'];
tokenKeys.forEach(key => localStorage.setItem(key, token));
localStorage.setItem('user', JSON.stringify({
    email: 'admin@luckygas.com',
    role: 'admin'
}));
console.log('‚úÖ Token injected!');
window.location.href = '${FRONTEND_URL}/index.html#/dashboard';
            `.trim();
            
            document.getElementById('console-script').textContent = script;
            document.getElementById('console-script').style.display = 'block';
            
            navigator.clipboard.writeText(script);
            showStatus('method6', '‚úÖ Script copied to clipboard! Paste in console.', 'success');
            log('Console script generated and copied to clipboard');
        }

        function createBookmarklet() {
            log('METHOD 7: Creating bookmarklet...');
            
            const bookmarklet = `javascript:(function(){
                const t='${latestToken || 'GET_TOKEN_FIRST'}';
                ['token','auth_token','jwt'].forEach(k=>localStorage.setItem(k,t));
                location.href='${FRONTEND_URL}/index.html#/dashboard';
            })();`;
            
            navigator.clipboard.writeText(bookmarklet);
            showStatus('method7', '‚úÖ Bookmarklet copied! Create a bookmark and paste as URL.', 'success');
            log('Bookmarklet created and copied to clipboard');
        }

        function forceDashboard() {
            log('METHOD 8: Forcing dashboard access (no auth)...');
            
            // Set a dummy token if needed
            if (!localStorage.getItem('token')) {
                const dummyToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhZG1pbkBsdWNreWdhcy5jb20ifQ.dummy';
                localStorage.setItem('token', dummyToken);
                log('Set dummy token for forced access');
            }
            
            showStatus('method8', '‚ö†Ô∏è Forcing redirect to dashboard...', 'info');
            window.location.href = `${FRONTEND_URL}/index.html#/dashboard`;
        }

        // Initialize on load
        window.addEventListener('load', () => {
            log('EMERGENCY PORTAL READY');
            log(`Current time: ${new Date().toLocaleString()}`);
            log(`Your browser: ${navigator.userAgent.substring(0, 50)}...`);
            
            // Check for existing tokens
            const existingToken = localStorage.getItem('token');
            if (existingToken) {
                log(`WARNING: Existing token found in localStorage`);
                log(`Token: ${existingToken.substring(0, 50)}...`);
            }
        });
    </script>
</body>
</html>